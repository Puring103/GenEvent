# GenEvent 测试计划

为项目实现完善的测试，在不同的文件中测试项目的不同特性。

## 核心流程

1. **基础事件 publish 与处理**  
   单事件、单订阅者，能正确触发并收到事件。

2. **订阅生命周期（StartListening / StopListening）**  
   - 只 Start 不 Stop 时能收到事件；Stop 后不再收到。  
   - 同一订阅者多次 Start/Stop 的预期行为（幂等或重复注册）。  
   - 单事件类型的 `StartListening<TSubscriber, TGenEvent>` / `StopListening<TSubscriber, TGenEvent>` 只影响该事件。

3. **多订阅者与多事件类型**  
   - 同一事件多个订阅者都能收到。  
   - 不同事件类型互不干扰。  
   - 同一订阅者类订阅多种事件时，每种事件都按预期触发。

4. **PublishConfig 状态清除**  
   - Publish 后 `PublishConfig` 会 Clear；连续两次 Publish（第一次带 WithFilter/Cancelable，第二次不带）验证第二次不受影响。

## 取消与优先级

5. **带取消的 Publish**  
   使用 `Cancelable<TGenEvent>()`，某订阅者返回 false 时后续不再调用，Publish 返回 false，行为符合预期。

6. **事件优先级**  
   利用高优先级订阅者取消传播，验证调用顺序为 Primary → High → Medium → Low → End，且取消后后续优先级不再执行。

## 筛选器

7. **每种筛选器单独测试**  
   - `WithFilter(Predicate<object>)` 自定义谓词。  
   - `ExcludeSubscriber` / `IncludeSubscriber`（单对象）。  
   - `ExcludeSubscribers` / `IncludeSubscribers`（HashSet<object>）。  
   - `OnlyType<TSubscriber>`（仅某类型收到）。  
   - `ExcludeType<TSubscriber>`（排除某类型）。

8. **多种筛选器组合**  
   同时使用多种筛选条件，结果符合“所有条件叠加”的预期。

## 扩展与语义

9. **结构体事件值语义**  
    事件为 struct，按值传递；订阅者内修改事件字段不影响调用方持有的副本（除非 ref）。

10. **订阅者内部再次 Publish 相同事件**  
    订阅者在处理某事件时再次 Publish 同一种事件：验证内外两层 Publish 的 `PublishConfig<TGenEvent>` 互不干扰（过滤/Cancelable 配置在各自作用域内生效），不会导致配置“泄漏”或状态混乱。

11. **订阅者 A 在处理过程中 Publish 另一种事件**  
    订阅者 A 处理事件 X 时 Publish 事件 Y：验证事件 X 与事件 Y 的 `PublishConfig` 相互独立，事件链路和优先级、筛选器都按各自事件类型的预期工作。

## 健壮性与生成

12. **边界与异常**  
    - 未调用 `GenEventBootstrap.Init()` 时 Publish 的异常或行为。  
    - 筛选器参数为 null（ExcludeSubscriber、IncludeSubscribers 等）应抛出 ArgumentNullException。  
    - 无订阅者时 Publish 返回 true（视为完成）。

13. **GC 与稳定性**  
    对各种情况做 GC 测试：大量订阅/退订、频繁 Publish、长时间运行等，无泄漏与异常。

14. **Source Generator / Bootstrap（若测试可引用生成代码）**  
    - 生成的 *Publisher 已注册到 `BaseEventPublisher.Publishers`。  
    - 生成的 *SubscriberRegistry 在 StartListening 后能收到对应事件。  
    - 优先级与生成代码中的调用顺序一致。